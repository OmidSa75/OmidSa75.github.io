<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Shared Memory in python | Omid Sadeghnezhad </title> <meta name="author" content="Omid Sadeghnezhad"> <meta name="description" content="Different types of shared memory in python which are provided by multiprocessing module."> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css?62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link defer href="/assets/css/bootstrap-toc.min.css?6f5af0bb9aab25d79b2448143cbeaa88" rel="stylesheet"> <link rel="shortcut icon" href="/assets/img/icon.png?62b3f84caf231c28be3ca860157d4872"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://sadeghnezhad.me/blog/2024/shared-memory-python/"> <script src="/assets/js/theme.js?a81d82887dd692e91686b43de4542f18"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>
    initTheme();
  </script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Omid</span> Sadeghnezhad </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About </a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">Blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/night_step/index.html">قدمِ شب </a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">Projects </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">CV </a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">Repositories </a> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="row"> <div class="col-sm-3"> <nav id="toc-sidebar" class="sticky-top"></nav> </div> <div class="col-sm-9"> <div class="post"> <header class="post-header"> <h1 class="post-title">Shared Memory in python</h1> <p class="post-meta"> Created on September 05, 2024 </p> <p class="post-tags"> <a href="/blog/2024"> <i class="fa-solid fa-calendar fa-sm"></i> 2024 </a>   ·   <a href="/blog/tag/programming"> <i class="fa-solid fa-hashtag fa-sm"></i> programming</a>   ·   <a href="/blog/category/sample-posts"> <i class="fa-solid fa-tag fa-sm"></i> sample-posts</a> </p> </header> <article class="post-content"> <div id="markdown-content"> <h1 id="introduction">Introduction</h1> <p>Consider you want to write a Python program and take advantage of multiprocessing logic. For example, some of your functions need to be run in different processes for parallelizing or some task handlers which are waiting to receive data on specific situations. However, there is a need to have a shared state in the memory so you can share data between your processes. So I’m going to introduce common multiprocessing shared memory in Python. Here I want to talk about the following shared states.</p> <ol> <li>Queue</li> <li>Pipe</li> <li>Manager</li> <li>SharedMemory</li> </ol> <h1 id="queue--pipe">Queue &amp; Pipe</h1> <h2 id="queue">Queue</h2> <p>Queue and Pipe are the simplest classes to be used in sharing data between processes. Creating a Queue will give you an object with which you can put and get data from it. Put data in a process and get that data in another process. The Queue is used to communicate between multiple processes.</p> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/posts/shared-memory-python/Queue-480.webp 480w,/assets/img/posts/shared-memory-python/Queue-800.webp 800w,/assets/img/posts/shared-memory-python/Queue-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/posts/shared-memory-python/Queue.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <p>The Python Code:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">time</span>
<span class="kn">import</span> <span class="n">multiprocessing</span> <span class="k">as</span> <span class="n">mp</span>


<span class="k">def</span> <span class="nf">process_1</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">queue</span><span class="p">:</span><span class="n">mp</span><span class="p">.</span><span class="n">Queue</span><span class="p">):</span>
  <span class="k">for</span> <span class="n">_data</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Process 1 is sending data: </span><span class="si">{</span><span class="n">_data</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">queue</span><span class="p">.</span><span class="nf">put</span><span class="p">(</span><span class="n">_data</span><span class="p">)</span>
    <span class="n">time</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">process_2</span><span class="p">(</span><span class="n">queue</span><span class="p">:</span> <span class="n">mp</span><span class="p">.</span><span class="n">Queue</span><span class="p">):</span>
  <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="n">_data</span> <span class="o">=</span> <span class="n">queue</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Process 2 got `</span><span class="si">{</span><span class="n">_data</span><span class="si">}</span><span class="s">` data</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">time</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">"</span><span class="s">__main__</span><span class="sh">"</span><span class="p">:</span>
  <span class="n">shm_queue</span> <span class="o">=</span> <span class="n">mp</span><span class="p">.</span><span class="nc">Queue</span><span class="p">()</span>
  <span class="n">data_list</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="nf">range</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
  <span class="n">p1</span> <span class="o">=</span> <span class="n">mp</span><span class="p">.</span><span class="nc">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">process_1</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">data_list</span><span class="p">,</span> <span class="n">shm_queue</span><span class="p">),</span> <span class="n">daemon</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
  <span class="n">p2</span> <span class="o">=</span> <span class="n">mp</span><span class="p">.</span><span class="nc">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">process_2</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">shm_queue</span><span class="p">,</span> <span class="p">),</span> <span class="n">daemon</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
  <span class="n">p1</span><span class="p">.</span><span class="nf">start</span><span class="p">()</span>
  <span class="n">p2</span><span class="p">.</span><span class="nf">start</span><span class="p">()</span>
  <span class="n">p1</span><span class="p">.</span><span class="nf">join</span><span class="p">()</span>
  <span class="n">p2</span><span class="p">.</span><span class="nf">join</span><span class="p">()</span>
</code></pre></div></div> <h2 id="pipe">Pipe</h2> <p>The Pipe will give us two objects which refer to both the start and ending of a pipe, The first can send/receive data and, the second can receive/send data through it. The pipe is used for communication between two processes.</p> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/posts/shared-memory-python/Pipe-480.webp 480w,/assets/img/posts/shared-memory-python/Pipe-800.webp 800w,/assets/img/posts/shared-memory-python/Pipe-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/posts/shared-memory-python/Pipe.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">time</span>
<span class="kn">import</span> <span class="n">multiprocessing</span> <span class="k">as</span> <span class="n">mp</span>


<span class="k">def</span> <span class="nf">process_1</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">conn_1</span><span class="p">):</span>
  <span class="k">for</span> <span class="n">_data</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Process 1 is sending data: </span><span class="si">{</span><span class="n">_data</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">conn_1</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="n">_data</span><span class="p">)</span>
    <span class="n">time</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">process_2</span><span class="p">(</span><span class="n">conn_2</span><span class="p">):</span>
  <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="n">_data</span> <span class="o">=</span> <span class="n">conn_2</span><span class="p">.</span><span class="nf">recv</span><span class="p">()</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Process 2 got `</span><span class="si">{</span><span class="n">_data</span><span class="si">}</span><span class="s">` data</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">time</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">_data</span> <span class="o">==</span> <span class="sh">"</span><span class="s">END</span><span class="sh">"</span><span class="p">:</span>
      <span class="k">break</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">"</span><span class="s">__main__</span><span class="sh">"</span><span class="p">:</span>
  <span class="n">conn_1</span><span class="p">,</span> <span class="n">conn_2</span> <span class="o">=</span> <span class="n">mp</span><span class="p">.</span><span class="nc">Pipe</span><span class="p">()</span>
  <span class="n">data_list</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="nf">range</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span> <span class="o">+</span> <span class="p">[</span><span class="sh">"</span><span class="s">END</span><span class="sh">"</span><span class="p">]</span>
  <span class="n">p1</span> <span class="o">=</span> <span class="n">mp</span><span class="p">.</span><span class="nc">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">process_1</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">data_list</span><span class="p">,</span> <span class="n">conn_1</span><span class="p">),</span> <span class="n">daemon</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
  <span class="n">p2</span> <span class="o">=</span> <span class="n">mp</span><span class="p">.</span><span class="nc">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">process_2</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">conn_2</span><span class="p">,</span> <span class="p">),</span> <span class="n">daemon</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
  <span class="n">p1</span><span class="p">.</span><span class="nf">start</span><span class="p">()</span>
  <span class="n">p2</span><span class="p">.</span><span class="nf">start</span><span class="p">()</span>
  <span class="n">p1</span><span class="p">.</span><span class="nf">join</span><span class="p">()</span>
  <span class="n">p2</span><span class="p">.</span><span class="nf">join</span><span class="p">()</span>

</code></pre></div></div> <h2 id="comparison">Comparison</h2> <p>In Python’s <code class="language-plaintext highlighter-rouge">multiprocessing</code> module, both <code class="language-plaintext highlighter-rouge">Queue</code> and <code class="language-plaintext highlighter-rouge">Pipe</code> are used for communication between processes, but they serve slightly different purposes and have different characteristics. Here’s a comparison:</p> <h3 id="1-queue">1. <strong>Queue</strong>:</h3> <ul> <li> <strong>Purpose</strong>: <code class="language-plaintext highlighter-rouge">Queue</code> is designed for communication between multiple processes. It allows multiple producers (processes) to put data into the queue and multiple consumers (processes) to get data out of the queue.</li> <li> <strong>Implementation</strong>: <code class="language-plaintext highlighter-rouge">Queue</code> is built on top of a <code class="language-plaintext highlighter-rouge">Pipe</code> with an additional layer of locks and semaphores to ensure thread-safe and process-safe operations.</li> <li> <strong>Usage</strong>: <code class="language-plaintext highlighter-rouge">Queue</code> is often used when you have many processes that need to communicate with each other in a concurrent manner. It’s suitable for a producer-consumer pattern where one or more processes produce data, and one or more processes consume it.</li> <li> <strong>Interface</strong>: <code class="language-plaintext highlighter-rouge">Queue</code> provides a high-level API similar to the <code class="language-plaintext highlighter-rouge">queue.Queue</code> used in threading. It has methods like <code class="language-plaintext highlighter-rouge">put()</code>, <code class="language-plaintext highlighter-rouge">get()</code>, <code class="language-plaintext highlighter-rouge">empty()</code>, <code class="language-plaintext highlighter-rouge">full()</code>, etc.</li> </ul> <h3 id="2-pipe">2. <strong>Pipe</strong>:</h3> <ul> <li> <strong>Purpose</strong>: <code class="language-plaintext highlighter-rouge">Pipe</code> is used for communication between two processes. It establishes a direct connection between two endpoints (i.e., two processes).</li> <li> <strong>Implementation</strong>: <code class="language-plaintext highlighter-rouge">Pipe</code> is simpler than <code class="language-plaintext highlighter-rouge">Queue</code>. It provides a pair of connected file descriptors or connection objects, with one process writing to one end and another process reading from the other.</li> <li> <strong>Usage</strong>: <code class="language-plaintext highlighter-rouge">Pipe</code> is best used when you need a simple, low-level, and fast communication channel between exactly two processes. It can be used in both duplex (two-way) and simplex (one-way) modes.</li> <li> <strong>Interface</strong>: <code class="language-plaintext highlighter-rouge">Pipe</code> provides two connection objects, <code class="language-plaintext highlighter-rouge">conn1</code> and <code class="language-plaintext highlighter-rouge">conn2</code>. You can send and receive data using <code class="language-plaintext highlighter-rouge">send()</code> and <code class="language-plaintext highlighter-rouge">recv()</code> methods on these objects.</li> </ul> <h3 id="summary">Summary:</h3> <ul> <li> <strong>Queue</strong> is more flexible and suitable for scenarios where you need to manage communication among multiple processes in a thread-safe manner.</li> <li> <strong>Pipe</strong> is more straightforward and is ideal for direct communication between two processes.</li> </ul> <h1 id="managers">Managers</h1> <p>Manager is a server process that manages shared objects, it can also manage sharing over a network. It has Python data types like list and dict which are shared.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">time</span>
<span class="kn">import</span> <span class="n">multiprocessing</span> <span class="k">as</span> <span class="n">mp</span>

<span class="k">def</span> <span class="nf">process_1</span><span class="p">(</span><span class="n">shared_list</span><span class="p">):</span>
    <span class="n">range_numbers</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="nf">range</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">range_numbers</span><span class="p">:</span>
        <span class="n">shared_list</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">process_2</span><span class="p">(</span><span class="n">shared_list</span><span class="p">):</span>
    <span class="n">range_numbers</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="nf">range</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">range_numbers</span><span class="p">:</span>
        <span class="n">shared_list</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">"</span><span class="s">__main__</span><span class="sh">"</span><span class="p">:</span>
    <span class="n">manager</span> <span class="o">=</span> <span class="n">mp</span><span class="p">.</span><span class="nc">Manager</span><span class="p">()</span>
    <span class="n">shared_list</span> <span class="o">=</span> <span class="n">manager</span><span class="p">.</span><span class="nf">list</span><span class="p">()</span>
    <span class="n">p1</span> <span class="o">=</span> <span class="n">mp</span><span class="p">.</span><span class="nc">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">process_1</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">shared_list</span><span class="p">,),</span> <span class="n">daemon</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">p2</span> <span class="o">=</span> <span class="n">mp</span><span class="p">.</span><span class="nc">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">process_2</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">shared_list</span><span class="p">,),</span> <span class="n">daemon</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">p1</span><span class="p">.</span><span class="nf">start</span><span class="p">()</span>
    <span class="n">p2</span><span class="p">.</span><span class="nf">start</span><span class="p">()</span>
    <span class="n">p1</span><span class="p">.</span><span class="nf">join</span><span class="p">()</span>
    <span class="n">p2</span><span class="p">.</span><span class="nf">join</span><span class="p">()</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">The final list is : </span><span class="si">{</span><span class="n">shared_list</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div> <p>An example with a lock object to control the access.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">multiprocessing</span> <span class="k">as</span> <span class="n">mp</span>

<span class="k">def</span> <span class="nf">process_1</span><span class="p">(</span><span class="n">shared_list</span><span class="p">,</span> <span class="n">lock</span><span class="p">):</span>
    <span class="n">range_numbers</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="nf">range</span><span class="p">(</span><span class="mi">100</span><span class="p">))</span>
    <span class="k">with</span> <span class="n">lock</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">range_numbers</span><span class="p">:</span>
            <span class="n">shared_list</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">process_2</span><span class="p">(</span><span class="n">shared_list</span><span class="p">,</span> <span class="n">lock</span><span class="p">):</span>
    <span class="n">range_numbers</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="nf">range</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">))</span>
    <span class="k">with</span> <span class="n">lock</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">range_numbers</span><span class="p">:</span>
            <span class="n">shared_list</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">"</span><span class="s">__main__</span><span class="sh">"</span><span class="p">:</span>
    <span class="n">lock</span> <span class="o">=</span> <span class="n">mp</span><span class="p">.</span><span class="nc">Lock</span><span class="p">()</span>
    <span class="n">manager</span> <span class="o">=</span> <span class="n">mp</span><span class="p">.</span><span class="nc">Manager</span><span class="p">()</span>
    <span class="n">shared_list</span> <span class="o">=</span> <span class="n">manager</span><span class="p">.</span><span class="nf">list</span><span class="p">()</span>
    <span class="n">p1</span> <span class="o">=</span> <span class="n">mp</span><span class="p">.</span><span class="nc">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">process_1</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">shared_list</span><span class="p">,</span> <span class="n">lock</span><span class="p">),</span> <span class="n">daemon</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">p2</span> <span class="o">=</span> <span class="n">mp</span><span class="p">.</span><span class="nc">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">process_2</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">shared_list</span><span class="p">,</span> <span class="n">lock</span><span class="p">),</span> <span class="n">daemon</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">p1</span><span class="p">.</span><span class="nf">start</span><span class="p">()</span>
    <span class="n">p2</span><span class="p">.</span><span class="nf">start</span><span class="p">()</span>
    <span class="n">p1</span><span class="p">.</span><span class="nf">join</span><span class="p">()</span>
    <span class="n">p2</span><span class="p">.</span><span class="nf">join</span><span class="p">()</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">The final list is : </span><span class="si">{</span><span class="n">shared_list</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div> <h1 id="sharedmemory">SharedMemory</h1> <p>A SharedMemory object is a low level by creating it the interpreter gives you a part of a memory by its address with which you can read and write into it directly. The point is it gives you the higher performance compared to the previous methods but it needs more care in managing the read and write into it. You must specify the types, sizes, and shapes of your data. This is the implementation of SharedMemory with Numpy functionality.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">multiprocessing</span> <span class="k">as</span> <span class="n">mp</span>

<span class="kn">from</span> <span class="n">multiprocessing</span> <span class="kn">import</span> <span class="n">shared_memory</span>
<span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>


<span class="k">def</span> <span class="nf">process_1</span><span class="p">(</span><span class="n">shm_name</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="p">):</span>
    <span class="n">shm</span> <span class="o">=</span> <span class="n">shared_memory</span><span class="p">.</span><span class="nc">SharedMemory</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">shm_name</span><span class="p">)</span>  <span class="c1"># Connect to the shared memory address
</span>    <span class="n">shared_array</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">ndarray</span><span class="p">(</span>  <span class="c1"># Get the value from the shm
</span>            <span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span>
            <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span>
            <span class="nb">buffer</span><span class="o">=</span><span class="n">shm</span><span class="p">.</span><span class="n">buf</span>
            <span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">shared_array</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">"</span><span class="s">__main__</span><span class="sh">"</span><span class="p">:</span>
    <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">full</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">255</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">uint8</span><span class="p">)</span>  <span class="c1"># Create an array
</span>
    <span class="n">shm</span> <span class="o">=</span> <span class="n">shared_memory</span><span class="p">.</span><span class="nc">SharedMemory</span><span class="p">(</span><span class="n">create</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">array</span><span class="p">.</span><span class="n">size</span><span class="p">)</span>  <span class="c1"># Create a shared memory with the size of the array
</span>
    <span class="n">shared_array</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">ndarray</span><span class="p">(</span>  <span class="c1"># Initial a ndarray object
</span>        <span class="n">array</span><span class="p">.</span><span class="n">shape</span><span class="p">,</span>  <span class="c1"># Set the shape of the ndarray equals to the array
</span>        <span class="n">dtype</span><span class="o">=</span><span class="n">array</span><span class="p">.</span><span class="n">dtype</span><span class="p">,</span>  <span class="c1"># Set the type the same as the array type
</span>        <span class="nb">buffer</span><span class="o">=</span><span class="n">shm</span><span class="p">.</span><span class="n">buf</span><span class="p">,</span>  <span class="c1"># Connect the ndarray buffer to the shm buffer
</span>    <span class="p">)</span>
    <span class="n">np</span><span class="p">.</span><span class="nf">copyto</span><span class="p">(</span><span class="n">shared_array</span><span class="p">,</span> <span class="n">array</span><span class="p">)</span>  <span class="c1"># copy the array to the buffer
</span>    <span class="n">shm_name</span> <span class="o">=</span> <span class="n">shm</span><span class="p">.</span><span class="n">name</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">shm_name</span><span class="p">)</span>

    <span class="n">p1</span> <span class="o">=</span> <span class="n">mp</span><span class="p">.</span><span class="nc">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">process_1</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">shm_name</span><span class="p">,</span> <span class="n">array</span><span class="p">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">array</span><span class="p">.</span><span class="n">dtype</span><span class="p">),</span> <span class="n">daemon</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">p1</span><span class="p">.</span><span class="nf">start</span><span class="p">()</span>  <span class="c1"># Start the process
</span>    <span class="n">p1</span><span class="p">.</span><span class="nf">join</span><span class="p">()</span>
    <span class="n">shm</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>  <span class="c1"># Close the shm buffer
</span>    <span class="n">shm</span><span class="p">.</span><span class="nf">unlink</span><span class="p">()</span>  <span class="c1"># Disconnect all links to it
</span></code></pre></div></div> <h1 id="tutorial-video">Tutorial Video</h1> <p>I also prepared a YouTube video about this section.</p> <figure> <iframe src="https://www.youtube.com/embed/GVdupoMQ43c?si=IjAuNiE9OMVEQ_1x" class="img-fluid rounded z-depth-1" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen="" width="720" height="480"></iframe> </figure> <h1 id="conclusion">Conclusion</h1> <p>These are some methods of shared memory in python that you should select wisely by their usage. definitely, there are some other ways of sharing a memory in Python that I hope I can prepare other tutorials in the future.</p> <h1 id="references">References</h1> <ul> <li><a href="https://docs.python.org/3/library/multiprocessing.shared_memory.html#multiprocessing.shared_memory.SharedMemory" rel="external nofollow noopener" target="_blank">Shared Memory in Python</a></li> <li><a href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing-managers" rel="external nofollow noopener" target="_blank">Multiprocessing Python</a></li> <li><a href="https://excalidraw.com/#json=1FaN_i6OgUFryUADDnXEQ,8AsBYEFd3v4SJnZg62cLOQ" rel="external nofollow noopener" target="_blank">Excalidraw drawing link</a></li> </ul> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/plotly/">a post with plotly.js</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/photo-gallery/">a post with image galleries</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/ways-of-processing/">Ways of processing</a> </li> <div id="giscus_thread" style="max-width: 930px; margin: 0 auto;"> <script>
      let giscusTheme = determineComputedTheme();
      let giscusAttributes = {
        src: 'https://giscus.app/client.js',
        'data-repo': 'OmidSa75/OmidSa75.github.io',
        'data-repo-id': '658866513',
        'data-category': 'Comments',
        'data-category-id': '',
        'data-mapping': 'title',
        'data-strict': '1',
        'data-reactions-enabled': '1',
        'data-emit-metadata': '0',
        'data-input-position': 'bottom',
        'data-theme': giscusTheme,
        'data-lang': 'en',
        crossorigin: 'anonymous',
        async: '',
      };

      let giscusScript = document.createElement('script');
      Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value));
      document.getElementById('giscus_thread').appendChild(giscusScript);
    </script> <noscript>Please enable JavaScript to view the <a href="http://giscus.app/?ref_noscript" rel="external nofollow noopener" target="_blank">comments powered by giscus.</a> </noscript> </div> </div> </div> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2025 Omid Sadeghnezhad. Last updated: June 08, 2025. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js?a0db7e5d5c70cc3252b3138b0c91dcaf" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script defer src="/assets/js/bootstrap-toc.min.js?c82ff4de8b0955d6ff14f5b05eed7eb6"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?c8a01c11a92744d44b093fc3bda915df" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/assets/js/mathjax-setup.js?a5bb4e6a542c546dd929b24b8b236dfd"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script defer src="/assets/js/progress-bar.js?2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>
    addBackToTop();
  </script> <script type="module" src="/assets/js/search/ninja-keys.min.js?a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script src="/assets/js/search-setup.js?6c304f7b1992d4b60f7a07956e52f04a"></script> <script src="/assets/js/search-data.js"></script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> </body> </html>